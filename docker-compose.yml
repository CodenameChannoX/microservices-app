services:
  # Your existing services
  api-gateway:
    build: ./api-gateway
    ports: ["4000:4000"]
    depends_on: [mongodb, postgres]
  
  user-service:
    build: ./user-service
    ports: ["4001:4001"]
    depends_on: [postgres]
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/userdb
  
  product-service:
    build: ./product-service
    ports: ["4002:4002"]
    depends_on: [mongodb, postgres]
    environment:
      - MONGO_URL=mongodb://mongodb:27017/productdb
      - POSTGRES_URL=postgresql://user:password@postgres:5432/productdb
  
  order-service:
    build: ./order-service
    ports: ["4003:4003"]
    depends_on: [postgres]
    environment:
      - DATABASE_URL=postgresql://user:password@postgres:5432/orderdb
  
  # Databases
  mongodb:
    image: mongo:6
    ports: ["27017:27017"]
    volumes: [mongo-data:/data/db]
  
  postgres:
    image: postgres:15
    ports: ["5432:5432"]
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: microservices
    volumes: [postgres-data:/var/lib/postgresql/data]

volumes:
  mongo-data:
  postgres-data:
